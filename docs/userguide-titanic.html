<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script id="state" type="text">"{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :initially-collapse? false, :auto-scroll? false, :port 5678, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Thu Nov 04 22:49:44 CET 2021\"] nil [:hr]], :custom-footer [:div [:hr] [:hr]]}, :ids [\"1758\" \"1760\" \"1762\" \"1764\" \"1766\" \"1768\" \"1770\" \"1772\" \"1774\" \"1776\" \"1778\" \"1780\" \"1782\" \"1784\" \"1786\" \"1788\" \"1790\" \"1792\" \"1794\" \"1796\" \"1798\" \"1800\" \"1802\" \"1804\" \"1806\" \"1808\" \"1810\" \"1812\" \"1814\" \"1816\" \"1818\" \"1820\" \"1822\" \"1824\" \"1826\" \"1828\" \"1830\" \"1832\" \"1834\" \"1836\" \"1838\" \"1840\" \"1842\" \"1844\" \"1846\" \"1848\" \"1850\" \"1852\" \"1854\" \"1856\" \"1858\" \"1860\" \"1862\" \"1864\" \"1866\" \"1868\" \"1870\" \"1872\" \"1874\" \"1876\" \"1878\" \"1880\" \"1882\" \"1884\" \"1886\" \"1888\" \"1890\" \"1892\" \"1894\" \"1896\" \"1898\" \"1900\" \"1902\" \"1904\" \"1906\" \"1908\" \"1910\" \"1912\" \"1914\" \"1916\" \"1918\" \"1920\" \"1922\" \"1924\" \"1926\" \"1928\" \"1930\" \"1932\" \"1934\" \"1936\" \"1938\" \"1940\" \"1942\" \"1944\" \"1946\" \"1948\"], :id->content {\"1906\" [:div [:p] nil nil [:p/markdown \"and a accuracy of \\n0.9027777777777778\"]], \"1836\" [:div [:p] nil nil [:p/markdown \"They controll as well which information is returned.\"]], \"1874\" [:div [:p] [:div [:p/code {:code \"(def search-grid\\n  (->>\\n   (ml/sobol-gridsearch {:trees (ml/linear 100 500 10)\\n                         :mtry (ml/categorical [0 2 4])\\n                         :split-rule (ml/categorical [:gini :entropy])\\n                         :max-depth (ml/linear 1 50 10)\\n                         :node-size (ml/linear 1 10 10)})\\n\\n   (take 500)))\", :bg-class \"bg-light\"}]] nil nil], \"1942\" [:div [:p] [:div [:p/code {:code \"(def train-metrices\\n  (->> training-curve-evaluations flatten (map #(-> % :train-transform :metric))))\", :bg-class \"bg-light\"}]] nil nil], \"1796\" [:div [:p] nil nil [:p/markdown \"We want to create a new column :title which might help in the score.\\nThis is an example of custom function, which creates a new column from existing columns,\\nwhich is a typical case of feature engineering.\"]], \"1776\" [:div [:p] [:div [:p/code {:code \"(def categorical-feature-columns [:pclass :sex :age :parch\\n                                    :embarked])\", :bg-class \"bg-light\"}]] nil nil], \"1802\" [:div [:p] [:div [:p/code {:code \"(defn categorize-title [data]\\n (->\\n    data\\n    (ds/add-or-replace-column\\n     :title\\n     (map title-map (:title data)))))\", :bg-class \"bg-light\"}]] nil nil], \"1774\" [:div [:p] nil nil [:p/markdown \"We can explore the association between the categorical columns of the dataset\\nwith the :survived using cramers-v-corrected:\"]], \"1798\" [:div [:p] [:div [:p/code {:code \"(defn name->title [dataset]\\n  (-> dataset\\n      (ds/add-or-replace-column\\n       :title\\n       (map\\n        #(-> % (str/split  #\\\"\\\\.\\\")\\n             first\\n             (str/split  #\\\"\\\\,\\\")\\n             last\\n             str/trim)\\n        (data :name)))\\n      (ds/drop-columns :name)))\", :bg-class \"bg-light\"}]] nil nil], \"1880\" [:div [:p] [:div [:p/code {:code \"(defn xgboost-pipe [opts]\\n  (ml/pipeline\\n     pipeline-fn\\n     {:metamorph/id :model}\\n     (mm/model\\n      (merge opts\\n             {:model-type :xgboost/classification}))))\", :bg-class \"bg-light\"}]] nil nil], \"1934\" [:div [:p] [:div [:p/code {:code \"(def training-curve-splits\\n  (map\\n   #(hash-map :train (ds/head (:train-val ds-split) %)\\n              :test (:test ds-split))\\n   (range 5 (ds/row-count (:train-val ds-split)) 10)))\", :bg-class \"bg-light\"}]] nil nil], \"1766\" [:div [:p] nil nil [:p/markdown \"### Read data\"]], \"1856\" [:div [:p] [:div [:p/code {:code \"(def predictions\\n  (->\\n   (full-pipeline-fn\\n    (assoc\\n     (:fit-ctx (first models))\\n     :metamorph/data (:test ds-split)\\n     :metamorph/mode :transform))\\n   :metamorph/data))\", :bg-class \"bg-light\"}]] nil nil], \"1866\" [:div [:p] nil nil [:p/markdown \"### Hyper parameter tuning\"]], \"1910\" [:div [:p] [:div [:p/code {:code \"(println \\\"acc: \\\" (-> best-model :test-transform :metric))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"1888\" [:div [:p] nil nil [:p/markdown \"Get the key information from the evaluations and sort by the metric function used,\\n accuracy here.\"]], \"1948\" [:div [:p] [:div [:p/code {:code \"(comment\\n  (->>\\n   (map\\n    #(hash-map :test-metric %1\\n               :train-metric %2\\n               :better? (if (> %1 %2) :test :train))\\n    (->> training-curve-evaluations flatten (map :metric))\\n    (->> training-curve-evaluations flatten (map #(get-in % [:train-prediction :metric]))))\\n   (map :better?)\\n   frequencies)\\n\\n  (println\\n   (-> (ds/dataset {:x [\\\"A\\\" \\\"B\\\" \\\"C\\\" \\\"D\\\" \\\"E\\\" \\\"F\\\"] :y (range)})\\n       (ds/categorical->one-hot [:x] {} :int)\\n       (ds/set-inference-target :y)\\n       (scicloj.metamorph.ml/train {:model-type :smile.regression/ordinary-least-square})\\n       ml/thaw-model)))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"1814\" [:div [:p] [:div [:p/code {:code \"(def ds-split (first (ds/split->seq data :holdout {:ratio [0.8 0.2]\\n                                                   :split-names [:train-val :test]})))\", :bg-class \"bg-light\"}]] nil nil], \"1772\" [:div [:p] [:div [:p/code {:code \"(ds/info data)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"data/titanic/train.csv: descriptive-stats [12 12]:\\n\\n|     :col-name | :datatype | :n-valid | :n-missing | :min |        :mean |              :mode |     :max | :standard-deviation |       :skew |                  :first |               :last |\\n|---------------|-----------|---------:|-----------:|-----:|-------------:|--------------------|---------:|--------------------:|------------:|-------------------------|---------------------|\\n|          :age |  :float64 |      714 |        177 | 0.42 |  29.69911765 |                    |  80.0000 |         14.52649733 |  0.38910778 |                   22.00 |               32.00 |\\n|        :cabin |   :string |      204 |        687 |      |              |                    |          |                     |             |                         |                     |\\n|     :embarked |   :string |      889 |          2 |      |              |                  S |          |                     |             |                       S |                   Q |\\n|         :fare |  :float64 |      891 |          0 | 0.00 |  32.20420797 |                    | 512.3292 |         49.69342860 |  4.78731652 |                   7.250 |               7.750 |\\n|         :name |   :string |      891 |          0 |      |              | Mallet, Mr. Albert |          |                     |             | Braund, Mr. Owen Harris | Dooley, Mr. Patrick |\\n|        :parch |    :int16 |      891 |          0 | 0.00 |   0.38159371 |                    |   6.0000 |          0.80605722 |  2.74911705 |                       0 |                   0 |\\n| :passenger-id |    :int16 |      891 |          0 | 1.00 | 446.00000000 |                    | 891.0000 |        257.35384202 |  0.00000000 |                       1 |                 891 |\\n|       :pclass |    :int16 |      891 |          0 | 1.00 |   2.30864198 |                    |   3.0000 |          0.83607124 | -0.63054791 |                       3 |                   3 |\\n|          :sex |   :string |      891 |          0 |      |              |               male |          |                     |             |                    male |                male |\\n|       :sib-sp |    :int16 |      891 |          0 | 0.00 |   0.52300786 |                    |   8.0000 |          1.10274343 |  3.69535173 |                       1 |                   0 |\\n|     :survived |    :int16 |      891 |          0 | 0.00 |   0.38383838 |                    |   1.0000 |          0.48659245 |  0.47852344 |                       0 |                   0 |\\n|       :ticket |   :string |      891 |          0 |      |              |           CA. 2343 |          |                     |             |               A/5 21171 |              370376 |\\n\\n\"}]], \"1904\" [:div [:p] nil nil [:p/markdown \"with a mean accuracy of \\n0.8140625\"]], \"1900\" [:div [:p] nil nil [:p/markdown \"which is: \"]], \"1876\" [:div [:p] nil nil [:p/markdown \"Generate the pipeline-fns we want to evaluate.\"]], \"1816\" [:div [:p] nil nil [:p/markdown \"Create a sequence of train/test  (k-fold with k=10) splits used to evaluate the pipeline.\"]], \"1918\" [:div [:p] [:div [:p/code {:code \"(def test-data (ds/dataset \\\"data/titanic/test.csv\\\"\\n                           {:key-fn csk/->kebab-case-keyword}))\", :bg-class \"bg-light\"}]] nil nil], \"1912\" [:div [:p] nil nil [:p/markdown \"using options: \"]], \"1782\" [:div [:p] nil nil [:p/markdown \"Association between the select variables:\"]], \"1864\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\n(->\\n (ml/confusion-map (:survived predictions)\\n                   (:survived trueth)\\n                   :none)\\n (ml/confusion-map->ds))\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"230px\"}} [:p/markdown \"_unnamed [3 3]:\\n\\n| :column-name |  0 |  1 |\\n|--------------|----|----|\\n|  column-name |  0 |  1 |\\n|            0 | 96 |  5 |\\n|            1 | 28 | 50 |\\n\"]]], \"1868\" [:div [:p] nil nil [:p/markdown \"This defines a pipeline with options. The options gets passed to the model function,\\nso become hyper-parameters of the model.\\n\\nThe `use-age?` options is used to make a conditional pipeline. As the use-age? variable becomes part of the grid to search in,\\nwe tune it as well.\\nThis is an example how pipeline-options can be grid searched in the same way then hyper-parameters of the model.\\n\\n\"]], \"1902\" [:div [:p] [:div [:p/code {:code \"(:model best-model)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"#object[ml.dmlc.xgboost4j.java.Booster 0x30d13463 \\\"ml.dmlc.xgboost4j.java.Booster@30d13463\\\"]\\n\"}]], \"1838\" [:div [:p] nil nil [:p/markdown \"`tech.ml` stores the models in the context in a serialzed form,\\nand the function `thaw-model` can be used to get the original model back.\\nThis is a Java class in the case of\\n model :smile.classification/random.forest, but this depends on the\\nwhich `model` function is in the pipeline\"]], \"1784\" [:div [:p] [:div [:p/code {:code \"(for [c1 categorical-feature-columns c2 categorical-feature-columns]\\n  {[c1 c2]\\n   (stats/cramers-v-corrected (get data c1) (get data  c2))})\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({[:pclass :pclass] 1.0}\\n {[:pclass :sex] 0.1296896503052887}\\n {[:pclass :age] 0.3083742406780525}\\n {[:pclass :parch] 0.021952123038272046}\\n {[:pclass :embarked] 0.2637111024814829}\\n {[:sex :pclass] 0.12968965030528873}\\n {[:sex :sex] 0.9999999999999999}\\n {[:sex :age] 0.07314569623080924}\\n {[:sex :parch] 0.24710952428178493}\\n {[:sex :embarked] 0.1254672805309745}\\n {[:age :pclass] 0.3083742406780524}\\n {[:age :sex] 0.07314569623080973}\\n {[:age :age] 0.9999999999999996}\\n {[:age :parch] 0.2933617556368759}\\n {[:age :embarked] 0.24889228758508924}\\n {[:parch :pclass] 0.021952123038272067}\\n {[:parch :sex] 0.24710952428178493}\\n {[:parch :age] 0.2933617556368754}\\n {[:parch :parch] 0.9999999999999999}\\n {[:parch :embarked] 0.0}\\n {[:embarked :pclass] 0.2637111024814829}\\n {[:embarked :sex] 0.1254672805309745}\\n {[:embarked :age] 0.2488922875850892}\\n {[:embarked :parch] 0.0}\\n {[:embarked :embarked] 1.0})\\n\"}]], \"1800\" [:div [:p] [:div [:p/code {:code \"(def title-map\\n  {\\\"Major\\\" :a\\n   \\\"Col\\\" :a\\n   \\\"Rev\\\" :a\\n   \\\"Ms\\\" :b\\n   \\\"Miss\\\" :b\\n   \\\"Jonkheer\\\" :a\\n   \\\"Don\\\" :a\\n   \\\"Mlle\\\" :b\\n   \\\"Mr\\\" :a\\n   \\\"Master\\\" :a\\n   \\\"Capt\\\" :a\\n   \\\"Mrs\\\" :b\\n   \\\"Lady\\\" :b\\n   \\\"Sir\\\" :a\\n   \\\"Dr\\\" :a\\n   \\\"the Countess\\\" :b\\n   \\\"Mme\\\" :b})\", :bg-class \"bg-light\"}]] nil nil], \"1936\" [:div [:p] [:div [:p/code {:code \"(def training-curve-evaluations\\n  (ml/evaluate-pipelines [(:pipe-fn (first models))]\\n                         training-curve-splits\\n                         ml/classification-accuracy\\n                         :accuracy\\n                         {:map-fn :map\\n                          :return-best-pipeline-only false\\n                          :return-best-crossvalidation-only false\\n                          :result-dissoc-in-seq []}))\", :bg-class \"bg-light\"}]] nil nil], \"1826\" [:div [:p] [:div [:p/code {:code \"(def evaluations\\n  (ml/evaluate-pipelines\\n   [full-pipeline-fn]\\n   train-val-splits\\n   ml/classification-accuracy\\n   :accuracy))\", :bg-class \"bg-light\"}]] nil nil], \"1804\" [:div [:p] nil nil [:p/markdown \"The final pipeline contains the functions we did before.\"]], \"1822\" [:div [:p] [:div [:p/code {:code \"(def full-pipeline-fn\\n  (ml/pipeline\\n   pipeline-fn\\n   ;; we overwrite the id, so the model function will store\\n   ;; it's output (the model) in the pipeline ctx under key :model\\n   {:metamorph/id :model}\\n   (mm/model {:model-type :smile.classification/random-forest})))\", :bg-class \"bg-light\"}]] nil nil], \"1808\" [:div [:p] nil nil [:p/markdown \"Transformed data\"]], \"1810\" [:div [:p] [:div [:p/code {:code \"(->\\n (pipeline-fn {:metamorph/data data :metamorph/mode :fit})\\n :metamorph/data)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"data/titanic/train.csv [891 9]:\\n\\n| :age-group | :cabin | :embarked |   :fare | :parch | :pclass | :sex | :survived | :title |\\n|-----------:|-------:|----------:|--------:|-------:|--------:|-----:|----------:|-------:|\\n|          2 |      2 |         1 |  7.2500 |      0 |       1 |    0 |         0 |      1 |\\n|          2 |      6 |         2 | 71.2833 |      0 |       0 |    1 |         1 |      0 |\\n|          2 |      2 |         1 |  7.9250 |      0 |       1 |    1 |         1 |      0 |\\n|          2 |      6 |         1 | 53.1000 |      0 |       0 |    1 |         1 |      0 |\\n|          2 |      2 |         1 |  8.0500 |      0 |       1 |    0 |         0 |      1 |\\n|          2 |      2 |         0 |  8.4583 |      0 |       1 |    0 |         0 |      1 |\\n|          2 |      7 |         1 | 51.8625 |      0 |       0 |    0 |         0 |      1 |\\n|          3 |      2 |         1 | 21.0750 |      0 |       1 |    0 |         0 |      1 |\\n|          2 |      2 |         1 | 11.1333 |      0 |       1 |    1 |         1 |      0 |\\n|          4 |      2 |         2 | 30.0708 |      0 |       2 |    1 |         1 |      0 |\\n|          3 |      8 |         1 | 16.7000 |      0 |       1 |    1 |         1 |      0 |\\n|          2 |      6 |         1 | 26.5500 |      0 |       0 |    1 |         1 |      0 |\\n|          2 |      2 |         1 |  8.0500 |      0 |       1 |    0 |         0 |      1 |\\n|          2 |      2 |         1 | 31.2750 |      0 |       1 |    0 |         0 |      1 |\\n|          4 |      2 |         1 |  7.8542 |      0 |       1 |    1 |         0 |      0 |\\n|          2 |      2 |         1 | 16.0000 |      0 |       2 |    1 |         1 |      0 |\\n|          3 |      2 |         0 | 29.1250 |      0 |       1 |    0 |         0 |      1 |\\n|          2 |      2 |         1 | 13.0000 |      0 |       2 |    0 |         1 |      1 |\\n|          2 |      2 |         1 | 18.0000 |      0 |       1 |    1 |         0 |      0 |\\n|          2 |      2 |         2 |  7.2250 |      0 |       1 |    1 |         1 |      0 |\\n|          2 |      2 |         1 | 26.0000 |      0 |       2 |    0 |         0 |      1 |\\n|          2 |      3 |         1 | 13.0000 |      0 |       2 |    0 |         1 |      1 |\\n|          4 |      2 |         0 |  8.0292 |      0 |       1 |    1 |         1 |      0 |\\n|          2 |      0 |         1 | 35.5000 |      0 |       0 |    0 |         1 |      1 |\\n|          3 |      2 |         1 | 21.0750 |      0 |       1 |    1 |         0 |      0 |\\n\\n\"}]], \"1820\" [:div [:p] nil nil [:p/markdown \"The full pipeline definition including the random forrest model.\"]], \"1944\" [:div [:p] [:div [:p/code {:code \"(def traing-curve-plot-data\\n  (reverse\\n   (sort-by :metric\\n            (flatten\\n             (map\\n              #(vector (zipmap [:count :metric :type] [%1 %2 :test])\\n                       (zipmap [:count :metric :type] [%1 %3 :train]))\\n              train-counts\\n              test-metrices\\n              train-metrices)))))\", :bg-class \"bg-light\"}]] nil nil], \"1938\" [:div [:p] [:div [:p/code {:code \"(def train-counts\\n  (->> training-curve-evaluations flatten (map #(-> % :fit-ctx :metamorph/data ds/row-count))))\", :bg-class \"bg-light\"}]] nil nil], \"1898\" [:div [:p] [:div [:p/code {:code \"(def best-model (first models))\", :bg-class \"bg-light\"}]] nil nil], \"1884\" [:div [:p] nil nil [:p/markdown \"Evaluate all  pipelines and keep results\"]], \"1778\" [:div [:p] [:div [:p/code {:code \"(map\\n #(hash-map\\n   %\\n   (stats/cramers-v-corrected\\n    (get  data %)\\n    (:survived data)))\\n categorical-feature-columns)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({:pclass 0.33668387622245516}\\n {:sex 0.5426213749215026}\\n {:age 0.16991560132000488}\\n {:parch 0.15693364431605167}\\n {:embarked 0.17309891006164452})\\n\"}]], \"1758\" [:div [:p] [:div [:p/code {:code \"(comment\\n  (note/init-with-browser)\\n  (note/eval-this-notespace)\\n  (note/reread-this-notespace)\\n  (note/render-static-html \\\"docs/userguide-titanic.html\\\")\\n\\n  (note/init))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"1842\" [:div [:p] [:div [:p/code {:code \"(def models\\n  (->> evaluations\\n       flatten\\n       (map\\n        #(hash-map :model (ml/thaw-model (get-in % [:fit-ctx :model]))\\n                   :metric ((comp :metric :test-transform) %)\\n                   :fit-ctx (:fit-ctx %)))\\n                   \\n       (sort-by :mean)\\n       reverse))\", :bg-class \"bg-light\"}]] nil nil], \"1832\" [:div [:p] nil nil [:p/markdown \"Often we consider the model with the lowest loss to be the best.\"]], \"1818\" [:div [:p] [:div [:p/code {:code \"(def train-val-splits\\n    (ds/split->seq\\n     (:train-val ds-split)\\n     :kfold\\n     {:k 10}))\", :bg-class \"bg-light\"}]] nil nil], \"1794\" [:div [:p] [:div [:p/code {:code \"(defn categorize-age [data]\\n  (->\\n   data\\n   (ds/add-or-replace-column\\n    :age-group\\n    (map\\n     #(cond\\n        (< % 10) :child\\n        (< % 18) :teen\\n        (< % 60) :adult\\n        (> % 60) :elderly\\n        true :other)\\n     (:age data)))))\", :bg-class \"bg-light\"}]] nil nil], \"1792\" [:div [:p] [:div [:p/code {:code \"(defn categorize-cabin [data]\\n  (-> data\\n      (ds/add-or-replace-column\\n       :cabin\\n       (map\\n        #(if (empty? %)\\n           :unknown\\n           (keyword (subs\\n                     %\\n                     0 1)))\\n        (:cabin data)))))\", :bg-class \"bg-light\"}]] nil nil], \"1830\" [:div [:p] nil nil [:p/markdown \"The `evaluate-pipelines` fn averages the models per pipe-fn,\\nand returns the best.\\nSo we get a single model back, as we only have one pipe fn\"]], \"1858\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\npredictions\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \":_unnamed [179 3]:\\n\\n|          0 |          1 | :survived |\\n|-----------:|-----------:|----------:|\\n| 0.35079481 | 0.64920519 |       1.0 |\\n| 0.76170262 | 0.23829738 |       0.0 |\\n| 0.31529374 | 0.68470626 |       1.0 |\\n| 0.81164894 | 0.18835106 |       0.0 |\\n| 0.55586104 | 0.44413896 |       0.0 |\\n| 0.52944465 | 0.47055535 |       0.0 |\\n| 0.67456201 | 0.32543799 |       0.0 |\\n| 0.81985000 | 0.18015000 |       0.0 |\\n| 0.82230712 | 0.17769288 |       0.0 |\\n| 0.68123583 | 0.31876417 |       0.0 |\\n| 0.82230712 | 0.17769288 |       0.0 |\\n| 0.81740716 | 0.18259284 |       0.0 |\\n| 0.82209160 | 0.17790840 |       0.0 |\\n| 0.82448545 | 0.17551455 |       0.0 |\\n| 0.49560743 | 0.50439257 |       1.0 |\\n| 0.77970550 | 0.22029450 |       0.0 |\\n| 0.80957436 | 0.19042564 |       0.0 |\\n| 0.55491949 | 0.44508051 |       0.0 |\\n| 0.64842247 | 0.35157753 |       0.0 |\\n| 0.81217722 | 0.18782278 |       0.0 |\\n| 0.38261015 | 0.61738985 |       1.0 |\\n| 0.82448545 | 0.17551455 |       0.0 |\\n| 0.54229490 | 0.45770510 |       0.0 |\\n| 0.69768599 | 0.30231401 |       0.0 |\\n| 0.81740716 | 0.18259284 |       0.0 |\\n\"]]], \"1878\" [:div [:p] [:div [:p/code {:code \"(def pipeline-fns (map make-pipeline-fn search-grid))\", :bg-class \"bg-light\"}]] nil nil], \"1930\" [:div [:p] [:div [:p/code {:code \"(ds/write-csv! submission-ds \\\"submission.csv\\\")\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"1932\" [:div [:p] nil nil [:p/markdown \"### Learning curve\"]], \"1914\" [:div [:p] [:div [:p/code {:code \"(-> best-model :fit-ctx :model :options)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"{:subsample 0.85,\\n :scale-pos-weight 0.944,\\n :lambda 0.2686206896551724,\\n :round 25,\\n :model-type :xgboost/classification,\\n :gamma 0.33399999999999996,\\n :alpha 0.2686206896551724,\\n :max-depth 7,\\n :eta 0.1111111111111111}\\n\"}]], \"1854\" [:div [:p] nil nil [:p/markdown \"We do this by running the pipeline again, this time with new data and merging\\n:mode transform\"]], \"1908\" [:div [:p] [:div [:p/code {:code \"(println \\\"mean acc: \\\" (-> best-model :test-transform :mean))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"1760\" [:div [:p] [:div [:p/code {:code \"(require '[scicloj.ml.dataset :as ds]\\n         '[tech.v3.dataset.math :as ds-math]\\n         '[tech.v3.datatype.functional :as dfn]\\n         '[scicloj.ml.core :as ml]\\n         '[scicloj.ml.metamorph :as mm]\\n         '[camel-snake-kebab.core :as csk]\\n         '[scicloj.metamorph.ml.loss :as loss]\\n         '[clojure.string :as str]\\n         '[fastmath.stats :as stats]\\n         '[fastmath.random :as rnd]\\n         '[fitdistr.core :as fit]\\n         '[scicloj.ml.xgboost] :reload)\", :bg-class \"bg-light\"}]] [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(failed)\"]] nil], \"1790\" [:div [:p] nil nil [:p/markdown \"The follwoing functios will be used in the pipeline. They clean the\\nfeatures to make them better predictors.\"]], \"1894\" [:div [:p] [:div [:p/code {:code \"(count models)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"100\\n\"}]], \"1840\" [:div [:p] nil nil [:p/markdown \"We can get for example,  the models like this:\"]], \"1886\" [:div [:p] [:div [:p/code {:code \"(def evaluations\\n\\n  (ml/evaluate-pipelines\\n   (take 10\\n         (concat xgboost-pipes xgboost-pipes))\\n   train-val-splits\\n   ml/classification-accuracy\\n   :accuracy\\n   {:return-best-pipeline-only false\\n    :return-best-crossvalidation-only false\\n    ;; :evaluation-handler-fn (fn [m]\\n    ;;                          (println (:metric m)))\\n\\n\\n    :map-fn :map\\n    :result-dissoc-seq []}))\", :bg-class \"bg-light\"}]] nil nil], \"1846\" [:div [:p] [:div [:p/code {:code \"(-> models first :metric)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.875\\n\"}]], \"1848\" [:div [:p] nil nil [:p/markdown \"The one with the highest accuracy is then:\"]], \"1764\" [:div [:p] nil nil [:p/markdown \" In this example, we will train a model which is able to predict the survival of passengers from the Titanic dataset.\\nIn a real analysis, this would contain as well explorative analysis of the data, which I will skip here,\\nas the purpose is to showcase machine learning with scicloj.ml, which is about model evaluation and selection.\"]], \"1770\" [:div [:p] nil nil [:p/markdown \"Column info:\"]], \"1916\" [:div [:p] [:div [:p/code {:code \"(clojure.pprint/pprint (-> best-model :fit-ctx :model :options))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"1806\" [:div [:p] [:div [:p/code {:code \"(def pipeline-fn\\n  (ml/pipeline\\n   (mm/replace-missing :embarked :value \\\"S\\\")\\n   (mm/replace-missing :age :value tech.v3.datatype.functional/mean)\\n   (mm/update-column :parch str)\\n   (ml/lift categorize-age)\\n   (ml/lift name->title)\\n   (ml/lift categorize-title)\\n   (ml/lift categorize-cabin)\\n   (mm/select-columns [:age-group\\n                       :cabin\\n                       :embarked\\n                       :fare\\n                       :parch\\n                       :pclass\\n                       :sex\\n                       :survived\\n                       :title])\\n\\n   (fn [ctx]\\n     (assoc ctx :categorical-ds\\n            (:metamorph/data ctx)))\\n\\n\\n   (mm/categorical->number [:survived :pclass :sex :embarked\\n                            :title :age-group :cabin :parch] {} :int64)\\n\\n   (mm/set-inference-target :survived)))\", :bg-class \"bg-light\"}]] nil nil], \"1870\" [:div [:p] [:div [:p/code {:code \"(defn make-pipeline-fn [options]\\n\\n  (ml/pipeline\\n   pipeline-fn\\n   {:metamorph/id :model}\\n   (mm/model\\n    (merge options\\n           {:model-type :smile.classification/random-forest}))))\", :bg-class \"bg-light\"}]] nil nil], \"1882\" [:div [:p] [:div [:p/code {:code \"(def xgboost-pipes\\n  (->>\\n   (ml/sobol-gridsearch\\n    (ml/hyperparameters :xgboost/classification))\\n   (take 500)\\n   (map xgboost-pipe)))\", :bg-class \"bg-light\"}]] nil nil], \"1920\" [:div [:p] [:div [:p/code {:code \"(def predition-on-test\\n  (full-pipeline-fn\\n   (assoc (:fit-ctx best-model)\\n          :metamorph/data (ds/add-column test-data :survived nil)\\n          :metamorph/mode :transform)))\", :bg-class \"bg-light\"}]] nil nil], \"1852\" [:div [:p] nil nil [:p/markdown \"We can get the predictions on new-data, which for classification contain as well\\nthe posterior probabilities per class.\"]], \"1928\" [:div [:p] [:div [:p/code {:code \"(def submission-ds\\n  (-> prediction-ds\\n      (ds/select-columns [:passenger-id :survived])\\n      (ds/rename-columns {:passenger-id \\\"PassengerId\\\"\\n                          :survived \\\"Survived\\\"})))\", :bg-class \"bg-light\"}]] nil nil], \"1922\" [:div [:p] [:div [:p/code {:code \"(def prediction-ds\\n  (->\\n   (predition-on-test :metamorph/data)\\n   (ds/add-column :passenger-id (:passenger-id test-data))\\n   (ds/convert-types [:survived] :int)\\n   (ds/select-columns [:passenger-id :survived 0 1])))\", :bg-class \"bg-light\"}]] nil nil], \"1850\" [:div [:p] [:div [:p/code {:code \"(-> models first :model)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"#object[smile.classification.RandomForest 0x1a8e332e \\\"smile.classification.RandomForest@1a8e332e\\\"]\\n\"}]], \"1860\" [:div [:p] nil nil [:p/markdown \"Out of the predictions and the truth, we can construct the\\n confusion matrix.\"]], \"1812\" [:div [:p] nil nil [:p/markdown \"The following splits the dataset in three pieces,\\n train, val and test to predict on later.\\n\"]], \"1786\" [:div [:p] nil nil [:p/markdown \"This shows how much the columns are correlated. \"]], \"1892\" [:div [:p] nil nil [:p/markdown \"As we did several pipelines and several x-fold cross validation, we have quite some models trained in total \"]], \"1768\" [:div [:p] [:div [:p/code {:code \"(def data (ds/dataset \\\"data/titanic/train.csv\\\" {:key-fn csk/->kebab-case-keyword}))\", :bg-class \"bg-light\"}]] nil nil], \"1940\" [:div [:p] [:div [:p/code {:code \"(def test-metrices\\n  (->> training-curve-evaluations flatten (map #(-> % :test-transform :metric))))\", :bg-class \"bg-light\"}]] nil nil], \"1762\" [:div [:p] nil nil [:p/markdown \"## Introduction \"]], \"1844\" [:div [:p] nil nil [:p/markdown \"The accuracy of the best trained model is:\"]], \"1872\" [:div [:p] nil nil [:p/markdown \"Use sobol optimization, to find som grid points,\\nwhich cover in a smart way the hyper-parameter space.\"]], \"1946\" [:div [:p] [:div [:p/code {:code \"^kind/vega\\n{\\n :data {:values traing-curve-plot-data}\\n\\n :width 500\\n :height 500\\n :mark {:type \\\"line\\\"}\\n :encoding {:x {:field :count :type \\\"quantitative\\\"}\\n            :y {:field :metric :type \\\"quantitative\\\"}\\n            :color {:field :type}}}\", :bg-class \"bg-light\"}]] nil [:p/vega {:data {:values ({:count 65, :metric 0.9384615384615385, :type :train} {:count 195, :metric 0.9282051282051282, :type :train} {:count 55, :metric 0.9272727272727272, :type :train} {:count 175, :metric 0.92, :type :train} {:count 245, :metric 0.9183673469387755, :type :train} {:count 185, :metric 0.9135135135135135, :type :train} {:count 45, :metric 0.9111111111111111, :type :train} {:count 235, :metric 0.9106382978723404, :type :train} {:count 165, :metric 0.9090909090909091, :type :train} {:count 395, :metric 0.908860759493671, :type :train} {:count 205, :metric 0.9073170731707317, :type :train} {:count 505, :metric 0.9069306930693068, :type :train} {:count 665, :metric 0.9067669172932331, :type :train} {:count 75, :metric 0.9066666666666667, :type :train} {:count 225, :metric 0.9066666666666667, :type :train} {:count 705, :metric 0.9049645390070922, :type :train} {:count 585, :metric 0.9042735042735043, :type :train} {:count 685, :metric 0.9036496350364964, :type :train} {:count 525, :metric 0.9028571428571429, :type :train} {:count 535, :metric 0.902803738317757, :type :train} {:count 695, :metric 0.902158273381295, :type :train} {:count 265, :metric 0.9018867924528302, :type :train} {:count 275, :metric 0.9018181818181819, :type :train} {:count 285, :metric 0.9017543859649123, :type :train} {:count 295, :metric 0.9016949152542373, :type :train} {:count 465, :metric 0.9010752688172043, :type :train} {:count 485, :metric 0.9010309278350515, :type :train} {:count 495, :metric 0.901010101010101, :type :train} {:count 515, :metric 0.9009708737864078, :type :train} {:count 645, :metric 0.9007751937984496, :type :train} {:count 675, :metric 0.8992592592592593, :type :train} {:count 615, :metric 0.8991869918699187, :type :train} {:count 455, :metric 0.8989010989010989, :type :train} {:count 445, :metric 0.898876404494382, :type :train} {:count 385, :metric 0.8987012987012987, :type :train} {:count 345, :metric 0.8985507246376812, :type :train} {:count 325, :metric 0.8984615384615385, :type :train} {:count 255, :metric 0.8980392156862745, :type :train} {:count 655, :metric 0.8977099236641221, :type :train} {:count 565, :metric 0.8973451327433628, :type :train} {:count 545, :metric 0.8972477064220183, :type :train} {:count 595, :metric 0.8957983193277311, :type :train} {:count 335, :metric 0.8955223880597015, :type :train} {:count 305, :metric 0.8950819672131148, :type :train} {:count 475, :metric 0.8947368421052632, :type :train} {:count 625, :metric 0.8944, :type :train} {:count 605, :metric 0.8942148760330579, :type :train} {:count 85, :metric 0.8941176470588235, :type :train} {:count 575, :metric 0.893913043478261, :type :train} {:count 555, :metric 0.8936936936936937, :type :train} {:count 375, :metric 0.8933333333333333, :type :train} {:count 635, :metric 0.8929133858267717, :type :train} {:count 435, :metric 0.8919540229885057, :type :train} {:count 405, :metric 0.891358024691358, :type :train} {:count 365, :metric 0.8904109589041096, :type :train} {:count 155, :metric 0.8903225806451613, :type :train} {:count 355, :metric 0.8901408450704225, :type :train} {:count 415, :metric 0.8891566265060241, :type :train} {:count 135, :metric 0.888888888888889, :type :train} {:count 315, :metric 0.888888888888889, :type :train} {:count 215, :metric 0.8883720930232558, :type :train} {:count 35, :metric 0.8857142857142857, :type :train} {:count 425, :metric 0.8847058823529412, :type :train} {:count 145, :metric 0.8827586206896552, :type :train} {:count 115, :metric 0.8782608695652174, :type :train} {:count 95, :metric 0.8736842105263158, :type :train} {:count 125, :metric 0.872, :type :train} {:count 15, :metric 0.8666666666666667, :type :train} {:count 105, :metric 0.8666666666666667, :type :train} {:count 555, :metric 0.8435754189944134, :type :test} {:count 25, :metric 0.84, :type :train} {:count 575, :metric 0.8379888268156425, :type :test} {:count 655, :metric 0.8379888268156425, :type :test} {:count 665, :metric 0.8379888268156425, :type :test} {:count 365, :metric 0.8268156424581006, :type :test} {:count 545, :metric 0.8268156424581006, :type :test} {:count 565, :metric 0.8268156424581006, :type :test} {:count 605, :metric 0.8268156424581006, :type :test} {:count 635, :metric 0.8268156424581006, :type :test} {:count 675, :metric 0.8268156424581006, :type :test} {:count 685, :metric 0.8268156424581006, :type :test} {:count 705, :metric 0.8268156424581006, :type :test} {:count 595, :metric 0.8212290502793296, :type :test} {:count 615, :metric 0.8212290502793296, :type :test} {:count 625, :metric 0.8212290502793296, :type :test} {:count 645, :metric 0.8212290502793296, :type :test} {:count 695, :metric 0.8212290502793296, :type :test} {:count 355, :metric 0.8156424581005587, :type :test} {:count 435, :metric 0.8156424581005587, :type :test} {:count 495, :metric 0.8156424581005587, :type :test} {:count 585, :metric 0.8156424581005587, :type :test} {:count 295, :metric 0.8100558659217877, :type :test} {:count 325, :metric 0.8100558659217877, :type :test} {:count 95, :metric 0.8044692737430168, :type :test} {:count 375, :metric 0.8044692737430168, :type :test} {:count 425, :metric 0.8044692737430168, :type :test} {:count 455, :metric 0.8044692737430168, :type :test} {:count 465, :metric 0.8044692737430168, :type :test} {:count 475, :metric 0.8044692737430168, :type :test} {:count 505, :metric 0.8044692737430168, :type :test} {:count 25, :metric 0.7988826815642458, :type :test} {:count 115, :metric 0.7988826815642458, :type :test} {:count 445, :metric 0.7988826815642458, :type :test} {:count 535, :metric 0.7988826815642458, :type :test} {:count 35, :metric 0.7932960893854749, :type :test} {:count 335, :metric 0.7932960893854749, :type :test} {:count 385, :metric 0.7932960893854749, :type :test} {:count 405, :metric 0.7932960893854749, :type :test} {:count 415, :metric 0.7932960893854749, :type :test} {:count 485, :metric 0.7932960893854749, :type :test} {:count 525, :metric 0.7932960893854749, :type :test} {:count 145, :metric 0.7877094972067039, :type :test} {:count 155, :metric 0.7877094972067039, :type :test} {:count 255, :metric 0.7877094972067039, :type :test} {:count 285, :metric 0.7877094972067039, :type :test} {:count 345, :metric 0.7877094972067039, :type :test} {:count 105, :metric 0.782122905027933, :type :test} {:count 125, :metric 0.782122905027933, :type :test} {:count 225, :metric 0.782122905027933, :type :test} {:count 265, :metric 0.782122905027933, :type :test} {:count 515, :metric 0.782122905027933, :type :test} {:count 205, :metric 0.776536312849162, :type :test} {:count 305, :metric 0.776536312849162, :type :test} {:count 315, :metric 0.776536312849162, :type :test} {:count 215, :metric 0.7709497206703911, :type :test} {:count 235, :metric 0.7709497206703911, :type :test} {:count 395, :metric 0.7709497206703911, :type :test} {:count 135, :metric 0.7653631284916201, :type :test} {:count 165, :metric 0.7653631284916201, :type :test} {:count 175, :metric 0.7653631284916201, :type :test} {:count 275, :metric 0.7653631284916201, :type :test} {:count 245, :metric 0.7541899441340782, :type :test} {:count 15, :metric 0.7486033519553073, :type :test} {:count 75, :metric 0.7486033519553073, :type :test} {:count 195, :metric 0.7486033519553073, :type :test} {:count 185, :metric 0.7374301675977654, :type :test} {:count 85, :metric 0.7150837988826816, :type :test} {:count 45, :metric 0.7094972067039106, :type :test} {:count 55, :metric 0.6592178770949721, :type :test} {:count 65, :metric 0.6368715083798883, :type :test} {:count 5, :metric 0.6, :type :train} {:count 5, :metric 0.5642458100558659, :type :test})}, :width 500, :height 500, :mark {:type \"line\"}, :encoding {:x {:field :count, :type \"quantitative\"}, :y {:field :metric, :type \"quantitative\"}, :color {:field :type}}}]], \"1896\" [:div [:p] nil nil [:p/markdown \"As we sorted by mean accuracy, the first evaluation result is the best model,\"]], \"1788\" [:div [:p] nil nil [:p/markdown \"## clean some of the features\"]], \"1862\" [:div [:p] [:div [:p/code {:code \"(def trueth\\n  (->\\n   (full-pipeline-fn {:metamorph/data (:test ds-split) :metamorph/mode :fit})\\n   :metamorph/data\\n   tech.v3.dataset.modelling/labels))\", :bg-class \"bg-light\"}]] nil nil], \"1834\" [:div [:p] nil nil [:p/markdown \"Return a single model only (as a list of 1) , namely the best over all\\n pipeline functions\\nand all cross validations is the default behavoiur, but can be changed\\nwith the `tune options`.\"]], \"1780\" [:div [:p] nil nil [:p/markdown \"In this dataset, :sex seems to be the best predictor for survival.\"]], \"1828\" [:div [:p] nil nil [:p/markdown \"The default k-fold splits makes 10 folds,\\nso we train 10 models, each having its own loss.\"]], \"1824\" [:div [:p] nil nil [:p/markdown \"Evaluate the (single) pipeline function using the train/test split\"]], \"1924\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\nprediction-ds\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \":_unnamed [418 4]:\\n\\n| :passenger-id | :survived |          0 |          1 |\\n|--------------:|----------:|-----------:|-----------:|\\n|           892 |         0 | 0.90783226 | 0.09216773 |\\n|           893 |         1 | 0.34887707 | 0.65112293 |\\n|           894 |         0 | 0.77029639 | 0.22970358 |\\n|           895 |         0 | 0.87858284 | 0.12141719 |\\n|           896 |         1 | 0.25410187 | 0.74589813 |\\n|           897 |         0 | 0.84582800 | 0.15417203 |\\n|           898 |         1 | 0.42438072 | 0.57561928 |\\n|           899 |         0 | 0.83890182 | 0.16109821 |\\n|           900 |         1 | 0.13617620 | 0.86382377 |\\n|           901 |         0 | 0.86759627 | 0.13240373 |\\n|           902 |         0 | 0.91443908 | 0.08556090 |\\n|           903 |         0 | 0.84991628 | 0.15008372 |\\n|           904 |         1 | 0.05358608 | 0.94641393 |\\n|           905 |         0 | 0.83485383 | 0.16514611 |\\n|           906 |         1 | 0.05430716 | 0.94569290 |\\n|           907 |         1 | 0.11911248 | 0.88088751 |\\n|           908 |         0 | 0.87459493 | 0.12540509 |\\n|           909 |         0 | 0.85306638 | 0.14693362 |\\n|           910 |         0 | 0.71740848 | 0.28259152 |\\n|           911 |         1 | 0.13617620 | 0.86382377 |\\n|           912 |         0 | 0.67551398 | 0.32448608 |\\n|           913 |         0 | 0.66772693 | 0.33227310 |\\n|           914 |         1 | 0.09196322 | 0.90803677 |\\n|           915 |         0 | 0.70399719 | 0.29600281 |\\n|           916 |         1 | 0.05817035 | 0.94182962 |\\n\"]]], \"1890\" [:div [:p] [:div [:p/code {:code \"(def models\\n  (->> evaluations\\n       flatten\\n       (map\\n        #(assoc\\n          (select-keys % [:test-transform :fit-ctx :pipe-fn])\\n\\n          :model (ml/thaw-model (get-in % [:fit-ctx :model]))))\\n       (sort-by (comp :metric :test-transform))\\n       reverse))\", :bg-class \"bg-light\"}]] nil nil], \"1926\" [:div [:p] nil nil [:p/markdown \"# Create Subimssion file to Kaggle\"]]}}"</script>
    <script src="gorilla-notes/js/compiled/main.js"></script>
</html>
