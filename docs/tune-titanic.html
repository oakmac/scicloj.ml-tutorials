<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script id="state" type="text">"{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :initially-collapse? false, :auto-scroll? false, :port 5678, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Wed Sep 22 12:20:34 CEST 2021\"] nil [:hr]], :custom-footer [:div [:hr] [:hr]]}, :ids [\"33\" \"35\" \"37\" \"39\" \"41\" \"43\" \"45\" \"47\" \"49\" \"51\" \"53\" \"55\" \"57\" \"59\" \"61\" \"63\" \"65\" \"67\" \"69\" \"71\" \"73\" \"75\" \"77\" \"79\" \"81\" \"83\" \"85\" \"87\" \"89\" \"91\"], :id->content {\"83\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\n(->\\n (ml/confusion-map predicted-survival-hold-out\\n                   (holdout-ds :survived))\\n (ml/confusion-map->ds))\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"230px\"}} [:p/markdown \"_unnamed [3 3]:\\n\\n| :column-name |      0 |       1 |\\n|--------------|--------|---------|\\n|  column-name |      0 |       1 |\\n|            0 | 0.9211 | 0.07895 |\\n|            1 | 0.3538 |  0.6462 |\\n\"]]], \"51\" [:div [:p] [:div [:p/code {:code \"(def random-forrest-pipelines\\n  (map\\n   #(make-pipeline-fns :smile.classification/random-forest %)\\n   (ml/sobol-gridsearch {:scaling-options {:scale? (ml/categorical [true false])}\\n                         :replace-missing-options {:value (ml/categorical [dtfunc/mean dtfunc/median])}\\n                         :model-options {:trees (ml/categorical [5 50 100 250])\\n                                         :max_depth (ml/categorical [5 8 10])}})))\", :bg-class \"bg-light\"}]] nil nil], \"69\" [:div [:p] nil nil [:p/markdown \"best options found on train data: \"]], \"49\" [:div [:p] [:div [:p/code {:code \"(def logistic-regression-pipelines\\n  (map\\n   #(make-pipeline-fns :smile.classification/logistic-regression %)\\n   (ml/sobol-gridsearch {:scaling-options {:scale? (ml/categorical [true false])}\\n                         :replace-missing-options {:value (ml/categorical [dtfunc/mean dtfunc/median])}\\n                         :model-options {:lambda (ml/categorical [0.1 0.2 0.5 0.7 1])\\n                                         :tolerance (ml/categorical [0.1 0.01 0.001 0.0001])}})))\", :bg-class \"bg-light\"}]] nil nil], \"87\" [:div [:p] [:div [:p/code {:code \"(ml/explain\\n\\n (-> best-evaluation first first :fit-ctx :model))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"59\" [:div [:p] [:div [:p/code {:code \"(def holdout-ds ((first splits) :test))\", :bg-class \"bg-light\"}]] nil nil], \"89\" [:div [:p] [:div [:p/code {:code \"(clojure.reflect/reflect\\n (ml/thaw-model\\n  (-> best-evaluation first first :fit-ctx :model)))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"{:bases\\n #{java.lang.Object\\n   smile.classification.DataFrameClassifier\\n   smile.classification.SoftClassifier\\n   smile.feature.TreeSHAP},\\n :flags #{:public},\\n :members\\n #{{:name logger,\\n    :type org.slf4j.Logger,\\n    :declaring-class smile.classification.RandomForest,\\n    :flags #{:private :static :final}}\\n   {:name lambda$null$1,\\n    :return-type double,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [double<>],\\n    :exception-types [],\\n    :flags #{:private :static :synthetic}}\\n   {:name lambda$trim$6,\\n    :return-type double,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.classification.RandomForest$Model],\\n    :exception-types [],\\n    :flags #{:private :static :synthetic}}\\n   {:name fit,\\n    :return-type smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.data.formula.Formula smile.data.DataFrame],\\n    :exception-types [],\\n    :flags #{:public :static}}\\n   {:name lambda$prune$8,\\n    :return-type smile.classification.RandomForest$Model<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [int],\\n    :exception-types [],\\n    :flags #{:private :static :synthetic}}\\n   {:name smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types\\n    [smile.data.formula.Formula\\n     int\\n     smile.classification.RandomForest$Model<>\\n     smile.validation.ClassificationMetrics\\n     double<>\\n     smile.util.IntSet],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name metrics,\\n    :return-type smile.validation.ClassificationMetrics,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name fit,\\n    :return-type smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types\\n    [smile.data.formula.Formula\\n     smile.data.DataFrame\\n     int\\n     int\\n     smile.base.cart.SplitRule\\n     int\\n     int\\n     int\\n     double],\\n    :exception-types [],\\n    :flags #{:public :static}}\\n   {:name predict,\\n    :return-type int,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [java.lang.Object double<>],\\n    :exception-types [],\\n    :flags #{:public :bridge :synthetic}}\\n   {:name predict,\\n    :return-type int,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.data.Tuple],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name test,\\n    :return-type int<><>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.data.DataFrame],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name fit,\\n    :return-type smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types\\n    [smile.data.formula.Formula\\n     smile.data.DataFrame\\n     int\\n     int\\n     smile.base.cart.SplitRule\\n     int\\n     int\\n     int\\n     double\\n     int<>],\\n    :exception-types [],\\n    :flags #{:public :static}}\\n   {:name lambda$prune$7,\\n    :return-type smile.classification.RandomForest$Model,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types\\n    [smile.data.DataFrame smile.classification.RandomForest$Model],\\n    :exception-types [],\\n    :flags #{:private :synthetic}}\\n   {:name schema,\\n    :return-type smile.data.type.StructType,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name formula,\\n    :return-type smile.data.formula.Formula,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name fit,\\n    :return-type smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types\\n    [smile.data.formula.Formula\\n     smile.data.DataFrame\\n     int\\n     int\\n     smile.base.cart.SplitRule\\n     int\\n     int\\n     int\\n     double\\n     int<>\\n     java.util.stream.LongStream],\\n    :exception-types [],\\n    :flags #{:public :static}}\\n   {:name trim,\\n    :return-type smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [int],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name models,\\n    :type smile.classification.RandomForest$Model<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :flags #{:private}}\\n   {:name labels,\\n    :type smile.util.IntSet,\\n    :declaring-class smile.classification.RandomForest,\\n    :flags #{:private}}\\n   {:name metrics,\\n    :type smile.validation.ClassificationMetrics,\\n    :declaring-class smile.classification.RandomForest,\\n    :flags #{:private}}\\n   {:name trees,\\n    :return-type smile.classification.DecisionTree<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name predict,\\n    :return-type int,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [java.lang.Object],\\n    :exception-types [],\\n    :flags #{:public :bridge :synthetic}}\\n   {:name k,\\n    :type int,\\n    :declaring-class smile.classification.RandomForest,\\n    :flags #{:private}}\\n   {:name importance,\\n    :return-type double<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.classification.RandomForest$Model<>],\\n    :exception-types [],\\n    :flags #{:private :static}}\\n   {:name lambda$fit$3,\\n    :return-type smile.classification.RandomForest$Model<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [int],\\n    :exception-types [],\\n    :flags #{:private :static :synthetic}}\\n   {:name prune,\\n    :return-type smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.data.DataFrame],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name vote,\\n    :return-type int,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.data.Tuple double<>],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name merge,\\n    :return-type smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.classification.RandomForest],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name trees,\\n    :return-type smile.base.cart.CART<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [],\\n    :exception-types [],\\n    :flags #{:public :bridge :synthetic}}\\n   {:name lambda$trees$5,\\n    :return-type smile.classification.DecisionTree<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [int],\\n    :exception-types [],\\n    :flags #{:private :static :synthetic}}\\n   {:name predict,\\n    :return-type int,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.data.Tuple double<>],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name lambda$fit$2,\\n    :return-type smile.classification.RandomForest$Model,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types\\n    [int\\n     double\\n     int\\n     int<>\\n     int<>\\n     int<><>\\n     smile.data.DataFrame\\n     smile.classification.ClassLabels\\n     smile.data.vector.BaseVector\\n     smile.base.cart.SplitRule\\n     int\\n     int\\n     int\\n     int\\n     int<><>\\n     int<><>\\n     long],\\n    :exception-types [],\\n    :flags #{:private :static :synthetic}}\\n   {:name lambda$trees$4,\\n    :return-type smile.classification.DecisionTree,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [smile.classification.RandomForest$Model],\\n    :exception-types [],\\n    :flags #{:private :static :synthetic}}\\n   {:name serialVersionUID,\\n    :type long,\\n    :declaring-class smile.classification.RandomForest,\\n    :flags #{:private :static :final}}\\n   {:name smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types\\n    [smile.data.formula.Formula\\n     int\\n     smile.classification.RandomForest$Model<>\\n     smile.validation.ClassificationMetrics\\n     double<>],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name lambda$fit$0,\\n    :return-type int,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [java.lang.Integer],\\n    :exception-types [],\\n    :flags #{:private :static :synthetic}}\\n   {:name formula,\\n    :type smile.data.formula.Formula,\\n    :declaring-class smile.classification.RandomForest,\\n    :flags #{:private}}\\n   {:name importance,\\n    :type double<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :flags #{:private}}\\n   {:name importance,\\n    :return-type double<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name models,\\n    :return-type smile.classification.RandomForest$Model<>,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name size,\\n    :return-type int,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types [],\\n    :exception-types [],\\n    :flags #{:public}}\\n   {:name fit,\\n    :return-type smile.classification.RandomForest,\\n    :declaring-class smile.classification.RandomForest,\\n    :parameter-types\\n    [smile.data.formula.Formula\\n     smile.data.DataFrame\\n     java.util.Properties],\\n    :exception-types [],\\n    :flags #{:public :static}}}}\\n\"}]], \"61\" [:div [:p] [:div [:p/code {:code \"(def best-evaluation\\n  (ml/evaluate-pipelines\\n   all-pipelines\\n   (ds/split->seq train-ds :kfold 5)\\n   ml/classification-accuracy\\n   :accuracy\\n   {:return-best-crossvalidation-only true\\n    :return-best-pipeline-only true}))\", :bg-class \"bg-light\"}]] nil nil], \"57\" [:div [:p] [:div [:p/code {:code \"(def train-ds ((first splits) :train))\", :bg-class \"bg-light\"}]] nil nil], \"33\" [:div [:p] [:div [:p/code {:code \"(comment\\n  (note/init-with-browser)\\n  (note/eval-this-notespace)\\n  (note/reread-this-notespace)\\n  (note/render-static-html \\\"docs/tune-titanic.html\\\")\\n  (note/init))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"67\" [:div [:p] [:div [:p/code {:code \"(def best-options (-> best-evaluation first first :fit-ctx :pipe-options))\", :bg-class \"bg-light\"}]] nil nil], \"81\" [:div [:p] nil nil [:p/markdown \"Confusion matrix on holdout data\"]], \"47\" [:div [:p] [:div [:p/code {:code \"(defn make-pipeline-fns [model-type options]\\n\\n  (ml/pipeline\\n   (fn [ctx]\\n     (assoc ctx :pipe-options options))\\n   (apply mm/replace-missing  numeric-features (map->vec (:replace-missing-options options)))\\n   (mm/categorical->number [:survived ] {} :int64)\\n   (if (options :scaling-options :scale?)\\n     (mm/std-scale numeric-features {}))\\n   (mm/set-inference-target :survived)\\n   {:metamorph/id :model}\\n   (mm/model (merge (:model-options options)\\n                    {:model-type model-type}))))\", :bg-class \"bg-light\"}]] nil nil], \"73\" [:div [:p] [:div [:p/code {:code \"(def best-pipe-fn\\n  (-> best-evaluation first first :pipe-fn))\", :bg-class \"bg-light\"}]] nil nil], \"53\" [:div [:p] [:div [:p/code {:code \"(def all-pipelines (concat random-forrest-pipelines))\", :bg-class \"bg-light\"}]] nil nil], \"75\" [:div [:p] [:div [:p/code {:code \"(def predicted-survival-hold-out\\n  (->\\n   (best-pipe-fn\\n    (merge (-> best-evaluation first first :fit-ctx)\\n           {:metamorph/data holdout-ds :metamorph/mode :transform}))\\n   :metamorph/data\\n   ds/reverse-map-categorical-xforms\\n   :survived))\", :bg-class \"bg-light\"}]] nil nil], \"35\" [:div [:p] nil nil [:p/markdown \"This is the Clojure version of https://www.moritzkoerber.com/posts/preprocessing-hyperparameters/\"]], \"77\" [:div [:p] nil nil [:p/markdown \"Classication accuracy on holdout data: \"]], \"39\" [:div [:p] [:div [:p/code {:code \"(def  categorical-features  [:pclass :sex :embarked])\", :bg-class \"bg-light\"}]] nil nil], \"63\" [:div [:p] [:div [:p/code {:code \"(def best-accuracy (-> best-evaluation first first :metric))\", :bg-class \"bg-light\"}]] nil nil], \"43\" [:div [:p] [:div [:p/code {:code \"(defn map->vec [m] (flatten (into [] m)))\", :bg-class \"bg-light\"}]] nil nil], \"37\" [:div [:p] [:div [:p/code {:code \"(require  '[scicloj.ml.dataset :as ds]\\n          '[scicloj.ml.core :as ml]\\n          '[scicloj.ml.metamorph :as mm]\\n          '[camel-snake-kebab.core :as csk]\\n          '[tech.v3.datatype.functional :as dtfunc])\", :bg-class \"bg-light\"}]] nil nil], \"45\" [:div [:p] [:div [:p/code {:code \"(def data\\n  (-> (ds/dataset \\\"data/titanic/train.csv\\\"\\n                  {:key-fn csk/->kebab-case-keyword})\\n      (ds/select-columns (concat categorical-features numeric-features [:survived]))\\n      (ds/replace-missing categorical-features :value \\\"missing\\\")\\n      (ds/categorical->one-hot categorical-features)))\", :bg-class \"bg-light\"}]] nil nil], \"55\" [:div [:p] [:div [:p/code {:code \"(def splits (ds/split->seq data :holdout {:ratio 0.8}))\", :bg-class \"bg-light\"}]] nil nil], \"85\" [:div [:p] [:div [:p/code {:code \"(println\\n (ml/thaw-model\\n  (-> best-evaluation first first :fit-ctx :model)))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"41\" [:div [:p] [:div [:p/code {:code \"(def  numeric-features [:age :parch :fare])\", :bg-class \"bg-light\"}]] nil nil], \"91\" [:div [:p] [:div [:p/code {:code \"(print\\n (seq\\n  (.importance\\n   (ml/thaw-model\\n    (-> best-evaluation first first :fit-ctx :model)))))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"65\" [:div [:p] nil nil [:p/markdown \"best accuracy found on train data: \\n0.8461538461538461\"]], \"71\" [:div [:p] [:div [:p/code {:code \"best-options\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"{:scaling-options {:scale? true},\\n :replace-missing-options\\n {:value\\n  #object[tech.v3.datatype.statistics$median 0x7e8b5205 \\\"tech.v3.datatype.statistics$median@7e8b5205\\\"]},\\n :model-options {:trees 250, :max_depth 5}}\\n\"}]], \"79\" [:div [:p] [:div [:p/code {:code \"(ml/classification-accuracy predicted-survival-hold-out\\n                           (holdout-ds :survived))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.8212290502793296\\n\"}]]}}"</script>
    <script src="gorilla-notes/js/compiled/main.js"></script>
</html>
