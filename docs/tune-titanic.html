<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script id="state" type="text">"{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :initially-collapse? false, :auto-scroll? false, :port 5678, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Tue Jun 07 23:49:51 CEST 2022\"] nil [:hr]], :custom-footer [:div [:hr] [:hr]]}, :ids [\"1728\" \"1730\" \"1732\" \"1734\" \"1736\" \"1738\" \"1740\" \"1742\" \"1744\" \"1746\" \"1748\" \"1750\" \"1752\" \"1754\" \"1756\" \"1758\" \"1760\" \"1762\" \"1764\" \"1766\" \"1768\" \"1770\" \"1772\" \"1774\" \"1776\" \"1778\" \"1780\" \"1782\" \"1784\" \"1786\" \"1788\" \"1790\" \"1792\" \"1794\" \"1796\" \"1798\" \"1800\" \"1802\" \"1804\" \"1806\" \"1808\" \"1810\" \"1812\" \"1814\" \"1816\" \"1818\" \"1820\" \"1822\" \"1824\" \"1826\" \"1828\" \"1830\" \"1832\" \"1834\" \"1836\" \"1838\" \"1840\"], :id->content {\"1836\" [:div [:p] [:div [:p/code {:code \"(ml/thaw-model (:model  final-model))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"#object[smile.classification.RandomForest 0x72cdeaa3 \\\"smile.classification.RandomForest@72cdeaa3\\\"]\\n\"}]], \"1796\" [:div [:p] [:div [:p/code {:code \"best-pipe-decl\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"[[:scicloj.ml.tune-titanic/assoc-pipe-opts\\n  {:scaling-options {:scale? false},\\n   :replace-missing-options\\n   {:value\\n    #object[tech.v3.datatype.functional$mean 0x2a05f02a \\\"tech.v3.datatype.functional$mean@2a05f02a\\\"]},\\n   :model-options {:trees 50, :max-depth 10}}]\\n [:scicloj.ml.tune-titanic/replace-missing\\n  {:scaling-options {:scale? false},\\n   :replace-missing-options\\n   {:value\\n    #object[tech.v3.datatype.functional$mean 0x2a05f02a \\\"tech.v3.datatype.functional$mean@2a05f02a\\\"]},\\n   :model-options {:trees 50, :max-depth 10}}]\\n [:mm/categorical->number [:survived] {} :int64]\\n [:scicloj.ml.tune-titanic/maybe-std-scale\\n  {:scaling-options {:scale? false},\\n   :replace-missing-options\\n   {:value\\n    #object[tech.v3.datatype.functional$mean 0x2a05f02a \\\"tech.v3.datatype.functional$mean@2a05f02a\\\"]},\\n   :model-options {:trees 50, :max-depth 10}}]\\n [:mm/set-inference-target :survived]\\n #:metamorph{:id :model}\\n [:mm/model\\n  {:trees 50,\\n   :max-depth 10,\\n   :model-type :smile.classification/random-forest}]]\\n\"}]], \"1776\" [:div [:p] [:div [:p/code {:code \"(def best-options (-> best-evaluation first first :fit-ctx :pipe-options))\", :bg-class \"bg-light\"}]] nil nil], \"1802\" [:div [:p] [:div [:p/code {:code \"(def predicted-survival-hold-out\\n  (->\\n   (best-pipe-fn\\n    (merge (-> best-evaluation first first :fit-ctx)\\n           {:metamorph/data holdout-ds :metamorph/mode :transform}))\\n   :metamorph/data\\n   ds/reverse-map-categorical-xforms\\n   :survived))\", :bg-class \"bg-light\"}]] nil nil], \"1774\" [:div [:p] [:div [:p/code {:code \"(def best-accuracy (-> best-evaluation first first :train-transform :metric))\", :bg-class \"bg-light\"}]] nil nil], \"1798\" [:div [:p] nil nil [:p/markdown \"pipe sources information\"]], \"1766\" [:div [:p] [:div [:p/code {:code \"(def holdout-ds ((first splits) :test))\", :bg-class \"bg-light\"}]] nil nil], \"1740\" [:div [:p] nil nil [:p/markdown \"Preproceesing Pipelines including feature engineering\"]], \"1814\" [:div [:p] [:div [:p/code {:code \"(ml/thaw-model\\n (-> best-evaluation first first :fit-ctx :model))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"#object[smile.classification.RandomForest 0x45d6bd3a \\\"smile.classification.RandomForest@45d6bd3a\\\"]\\n\"}]], \"1772\" [:div [:p] [:div [:p/code {:code \"(def best-evaluation\\n  (ml/evaluate-pipelines\\n   all-pipelines\\n   (ds/split->seq train-ds :kfold 5)\\n   ml/classification-accuracy\\n   :accuracy\\n   {;; :attach-fn-sources {:ns (find-ns 'scicloj.ml.tune-titanic)\\n    ;;                         :pipe-fns-clj-file \\\"src/scicloj/ml/tune_titanic.clj\\\"}\\n    :return-best-crossvalidation-only true\\n    :return-best-pipeline-only true}))\", :bg-class \"bg-light\"}]] nil nil], \"1816\" [:div [:p] nil nil [:p/markdown \"Feature importance:\"]], \"1756\" [:div [:p] [:div [:p/code {:code \"(def all-pipelines (concat random-forrest-pipelines))\", :bg-class \"bg-light\"}]] nil nil], \"1782\" [:div [:p] [:div [:p/code {:code \"(def best-pipe-decl\\n  (-> best-evaluation first first :pipe-decl))\", :bg-class \"bg-light\"}]] nil nil], \"1732\" [:div [:p] [:div [:p/code {:code \"(require  '[scicloj.ml.dataset :as ds]\\n          '[scicloj.ml.core :as ml]\\n          '[scicloj.ml.metamorph :as mm]\\n          '[camel-snake-kebab.core :as csk]\\n          '[scicloj.metamorph.ml.evaluation-handler :as eval-hn]\\n          '[tech.v3.datatype.functional :as dtfunc])\", :bg-class \"bg-light\"}]] nil nil], \"1838\" [:div [:p] nil nil [:p/markdown \"trained with best hyper paramter\"]], \"1784\" [:div [:p] nil nil [:p/markdown \"## All information on best found pipeline\"]], \"1800\" [:div [:p] [:div [:p/code {:code \"(->\\n (ml/get-nice-source-info best-pipe-decl\\n                          (find-ns 'scicloj.ml.tune-titanic)\\n                          (-> #'data meta :file))\\n (update :classpath #(take 20 %)))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"{:fn-sources\\n #:mm{categorical->number\\n      {:source-str\\n       \\\"(defn categorical->number\\\\n  \\\\\\\"Convert columns into a discrete , numeric representation\\\\n  See tech.v3.dataset.categorical/fit-categorical-map.\\\\\\\"\\\\n  ([filter-fn-or-ds]\\\\n  (tech.v3.dataset.metamorph-api/categorical->number filter-fn-or-ds))\\\\n  ([filter-fn-or-ds table-args]\\\\n  (tech.v3.dataset.metamorph-api/categorical->number filter-fn-or-ds table-args))\\\\n  ([filter-fn-or-ds table-args result-datatype]\\\\n  (tech.v3.dataset.metamorph-api/categorical->number filter-fn-or-ds table-args result-datatype)))\\\",\\n       :source-form\\n       (defn\\n        categorical->number\\n        \\\"Convert columns into a discrete , numeric representation\\\\n  See tech.v3.dataset.categorical/fit-categorical-map.\\\"\\n        ([filter-fn-or-ds]\\n         (tech.v3.dataset.metamorph-api/categorical->number\\n          filter-fn-or-ds))\\n        ([filter-fn-or-ds table-args]\\n         (tech.v3.dataset.metamorph-api/categorical->number\\n          filter-fn-or-ds\\n          table-args))\\n        ([filter-fn-or-ds table-args result-datatype]\\n         (tech.v3.dataset.metamorph-api/categorical->number\\n          filter-fn-or-ds\\n          table-args\\n          result-datatype)))},\\n      model\\n      {:source-str\\n       \\\"(defn model\\\\n  \\\\\\\"Executes a machine learning model in train/predict (depending on :mode)\\\\n  from the `metamorph.ml` model registry.\\\\n\\\\n  The model is passed between both invocation via the shared context ctx in a\\\\n  key (a step indentifier) which is passed in key `:metamorph/id` and guarantied to be unique for each\\\\n  pipeline step.\\\\n\\\\n  The function writes and reads into this common context key.\\\\n\\\\n  Options:\\\\n  - `:model-type` - Keyword for the model to use\\\\n\\\\n  Further options get passed to `train` functions and are model specific.\\\\n\\\\n  See here for an overview for the models build into scicloj.ml:\\\\n\\\\n\\\\n  https://scicloj.github.io/scicloj.ml-tutorials/userguide-models.html\\\\n\\\\n  Other libraries might contribute other models,\\\\n  which are documented as part of the library.\\\\n\\\\n\\\\n  metamorph                            | .\\\\n  -------------------------------------|----------------------------------------------------------------------------\\\\n  Behaviour in mode :fit               | Calls `scicloj.metamorph.ml/train` using data in `:metamorph/data` and `options`and stores trained model in ctx under key in `:metamorph/id`\\\\n  Behaviour in mode :transform         | Reads trained model from ctx and calls `scicloj.metamorph.ml/predict` with the model in $id and data in `:metamorph/data`\\\\n  Reads keys from ctx                  | In mode `:transform` : Reads trained model to use for prediction from key in `:metamorph/id`.\\\\n  Writes keys to ctx                   | In mode `:fit` : Stores trained model in key $id and writes feature-ds and target-ds before prediction into ctx at `:scicloj.metamorph.ml/feature-ds` /`:scicloj.metamorph.ml/target-ds`\\\\n\\\\n\\\\n\\\\n\\\\n  See as well:\\\\n\\\\n  * `scicloj.metamorph.ml/train`\\\\n  * `scicloj.metamorph.ml/predict`\\\\n\\\\n  \\\\\\\"\\\\n  {:malli/schema [:=> [:cat map?] [map?]]}\\\\n  [options]\\\\n\\\\n  (malli/instrument-mm\\\\n   (fn [{:metamorph/keys [id data mode] :as ctx}]\\\\n\\\\n     (case mode\\\\n       :fit (assoc ctx\\\\n                   id (assoc (train data options)\\\\n                             ::unsupervised? (get (options->model-def options) :unsupervised? false)))\\\\n\\\\n       :transform  (do\\\\n                     (if (get-in ctx [id ::unsupervised?])\\\\n                       ctx\\\\n                       (-> ctx\\\\n                           (update\\\\n                                   id\\\\n                                   assoc\\\\n                                   ::feature-ds (cf/feature data)\\\\n                                   ::target-ds (cf/target data))\\\\n                           (assoc\\\\n                            :metamorph/data (predict data (get ctx id))))))))))\\\",\\n       :source-form\\n       (defn\\n        model\\n        \\\"Executes a machine learning model in train/predict (depending on :mode)\\\\n  from the `metamorph.ml` model registry.\\\\n\\\\n  The model is passed between both invocation via the shared context ctx in a\\\\n  key (a step indentifier) which is passed in key `:metamorph/id` and guarantied to be unique for each\\\\n  pipeline step.\\\\n\\\\n  The function writes and reads into this common context key.\\\\n\\\\n  Options:\\\\n  - `:model-type` - Keyword for the model to use\\\\n\\\\n  Further options get passed to `train` functions and are model specific.\\\\n\\\\n  See here for an overview for the models build into scicloj.ml:\\\\n\\\\n\\\\n  https://scicloj.github.io/scicloj.ml-tutorials/userguide-models.html\\\\n\\\\n  Other libraries might contribute other models,\\\\n  which are documented as part of the library.\\\\n\\\\n\\\\n  metamorph                            | .\\\\n  -------------------------------------|----------------------------------------------------------------------------\\\\n  Behaviour in mode :fit               | Calls `scicloj.metamorph.ml/train` using data in `:metamorph/data` and `options`and stores trained model in ctx under key in `:metamorph/id`\\\\n  Behaviour in mode :transform         | Reads trained model from ctx and calls `scicloj.metamorph.ml/predict` with the model in $id and data in `:metamorph/data`\\\\n  Reads keys from ctx                  | In mode `:transform` : Reads trained model to use for prediction from key in `:metamorph/id`.\\\\n  Writes keys to ctx                   | In mode `:fit` : Stores trained model in key $id and writes feature-ds and target-ds before prediction into ctx at `:scicloj.metamorph.ml/feature-ds` /`:scicloj.metamorph.ml/target-ds`\\\\n\\\\n\\\\n\\\\n\\\\n  See as well:\\\\n\\\\n  * `scicloj.metamorph.ml/train`\\\\n  * `scicloj.metamorph.ml/predict`\\\\n\\\\n  \\\"\\n        #:malli{:schema [:=> [:cat map?] [map?]]}\\n        [options]\\n        (malli/instrument-mm\\n         (fn\\n          [{:metamorph/keys [id data mode], :as ctx}]\\n          (case\\n           mode\\n           :fit\\n           (assoc\\n            ctx\\n            id\\n            (assoc\\n             (train data options)\\n             :scicloj.ml.tune-titanic/unsupervised?\\n             (get (options->model-def options) :unsupervised? false)))\\n           :transform\\n           (do\\n            (if\\n             (get-in ctx [id :scicloj.ml.tune-titanic/unsupervised?])\\n             ctx\\n             (->\\n              ctx\\n              (update\\n               id\\n               assoc\\n               :scicloj.ml.tune-titanic/feature-ds\\n               (cf/feature data)\\n               :scicloj.ml.tune-titanic/target-ds\\n               (cf/target data))\\n              (assoc\\n               :metamorph/data\\n               (predict data (get ctx id))))))))))},\\n      set-inference-target\\n      {:source-str\\n       \\\"(defn set-inference-target\\\\n  \\\\\\\"Set the inference target on the column.  This sets the :column-type member\\\\n  of the column metadata to :inference-target?.\\\\\\\"\\\\n  ([target-name-or-target-name-seq]\\\\n  (tech.v3.dataset.metamorph-api/set-inference-target target-name-or-target-name-seq)))\\\",\\n       :source-form\\n       (defn\\n        set-inference-target\\n        \\\"Set the inference target on the column.  This sets the :column-type member\\\\n  of the column metadata to :inference-target?.\\\"\\n        ([target-name-or-target-name-seq]\\n         (tech.v3.dataset.metamorph-api/set-inference-target\\n          target-name-or-target-name-seq)))}},\\n :classpath\\n (\\\"src\\\"\\n  \\\"resources\\\"\\n  \\\"/home/carsten/.m2/repository/aerial/hanami/aerial.hanami/0.12.9/aerial.hanami-0.12.9.jar\\\"\\n  \\\"/home/carsten/.gitlibs/libs/applied-science/waqi/faefe5dfd1b161ff70089924591ac2d699527811/resources\\\"\\n  \\\"/home/carsten/.gitlibs/libs/applied-science/waqi/faefe5dfd1b161ff70089924591ac2d699527811/src\\\"\\n  \\\"/home/carsten/.gitlibs/libs/appliedsciencestudio/rdata/151e6dead06b38995f1f30b09d954a060f7a2a9c/src\\\"\\n  \\\"/home/carsten/.gitlibs/libs/appliedsciencestudio/rdata/151e6dead06b38995f1f30b09d954a060f7a2a9c/resources\\\"\\n  \\\"/home/carsten/.m2/repository/ch/qos/logback/logback-classic/1.3.0-alpha10/logback-classic-1.3.0-alpha10.jar\\\"\\n  \\\"/home/carsten/.m2/repository/clj-python/libpython-clj/2.004/libpython-clj-2.004.jar\\\"\\n  \\\"/home/carsten/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.13.2/jackson-annotations-2.13.2.jar\\\"\\n  \\\"/home/carsten/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.13.2/jackson-core-2.13.2.jar\\\"\\n  \\\"/home/carsten/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.13.2/jackson-databind-2.13.2.jar\\\"\\n  \\\"/home/carsten/.m2/repository/com/github/luben/zstd-jni/1.5.1-1/zstd-jni-1.5.1-1.jar\\\"\\n  \\\"/home/carsten/.m2/repository/dk/simongray/datalinguist/0.1.163/datalinguist-0.1.163.jar\\\"\\n  \\\"/home/carsten/.m2/repository/generateme/fastmath/2.1.6/fastmath-2.1.6.jar\\\"\\n  \\\"/home/carsten/.gitlibs/libs/net.clojars.behrica/cluster_eval/ca34283a67bf18c8025955865fb567bd6e2e9a9a/src\\\"\\n  \\\"/home/carsten/.gitlibs/libs/net.clojars.behrica/cluster_eval/ca34283a67bf18c8025955865fb567bd6e2e9a9a/resources\\\"\\n  \\\"/home/carsten/.gitlibs/libs/net.clojars.behrica/cluster_eval/ca34283a67bf18c8025955865fb567bd6e2e9a9a/target/classes\\\"\\n  \\\"/home/carsten/.m2/repository/org/apache/arrow/arrow-vector/6.0.0/arrow-vector-6.0.0.jar\\\"\\n  \\\"/home/carsten/.m2/repository/org/clojure/clojure/1.11.1/clojure-1.11.1.jar\\\")}\\n\"}]], \"1826\" [:div [:p] nil nil [:p/markdown \"nested cv best models metrics\"]], \"1744\" [:div [:p] [:div [:p/code {:code \"(defn replace-missing [options]\\n  (fn [ctx]\\n    ( (apply mm/replace-missing numeric-features (map->vec (:replace-missing-options options))) ctx)))\", :bg-class \"bg-light\"}]] nil nil], \"1804\" [:div [:p] nil nil [:p/markdown \"Classication accuracy on holdout data: \"]], \"1736\" [:div [:p] [:div [:p/code {:code \"(def  numeric-features [:age :parch :fare])\", :bg-class \"bg-light\"}]] nil nil], \"1822\" [:div [:p] [:div [:p/code {:code \"(require '[scicloj.ml.nested-cv :as nested-cv])\", :bg-class \"bg-light\"}]] nil nil], \"1752\" [:div [:p] [:div [:p/code {:code \"(def logistic-regression-pipelines\\n  (map\\n   #(make-decl-pipeline :smile.classification/logistic-regression %)\\n   (ml/sobol-gridsearch {:scaling-options {:scale? (ml/categorical [true false])}\\n                         :replace-missing-options {:value (ml/categorical [dtfunc/mean dtfunc/median])}\\n                         :model-options {:lambda (ml/categorical [0.1 0.2 0.5 0.7 1])\\n                                         :tolerance (ml/categorical [0.1 0.01 0.001 0.0001])}})))\", :bg-class \"bg-light\"}]] nil nil], \"1808\" [:div [:p] nil nil [:p/markdown \"Confusion matrix on holdout data\"]], \"1810\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\n(->\\n (ml/confusion-map predicted-survival-hold-out\\n                   (holdout-ds :survived))\\n (ml/confusion-map->ds))\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"230px\"}} [:p/markdown \"_unnamed [3 3]:\\n\\n| :column-name |      0 |       1 |\\n|--------------|--------|---------|\\n|  column-name |      0 |       1 |\\n|            0 | 0.9130 | 0.08696 |\\n|            1 | 0.3438 |  0.6563 |\\n\"]]], \"1820\" [:div [:p] nil nil [:p/markdown \"## nested cross validation\"]], \"1730\" [:div [:p] nil nil [:p/markdown \"This is the Clojure version of https://www.moritzkoerber.com/posts/preprocessing-hyperparameters/\"]], \"1778\" [:div [:p] [:div [:p/code {:code \"(def best-pipe-fn\\n  (-> best-evaluation first first :pipe-fn))\", :bg-class \"bg-light\"}]] nil nil], \"1758\" [:div [:p] [:div [:p/code {:code \"(def pipe-fns\\n  (mapv ml/->pipeline all-pipelines))\", :bg-class \"bg-light\"}]] nil nil], \"1832\" [:div [:p] [:div [:p/code {:code \"(def final-model\\n  ((:best-pipe-fn final-model-by-cv)\\n   {:metamorph/data data :metamorph/mode :fit}))\", :bg-class \"bg-light\"}]] nil nil], \"1728\" [:div [:p] [:div [:p/code {:code \"(comment\\n  (note/init-with-browser)\\n  (note/eval-this-notespace)\\n  (note/reread-this-notespace)\\n  (note/render-static-html \\\"docs/tune-titanic.html\\\")\\n  (note/init))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"1818\" [:div [:p] [:div [:p/code {:code \"(seq\\n (.importance\\n  (ml/thaw-model\\n   (-> best-evaluation first first :fit-ctx :model))))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"(20.303393022842652\\n 1.614480002071886\\n 27.391128420061072\\n 0.5762732179450544\\n 2.8819796233011994\\n 1.240153265486774\\n 9.483477698358936\\n 2.247121810283474\\n 0.24041485945003443\\n 0.8984118356324664\\n 0.5117708709410651\\n 0.0)\\n\"}]], \"1794\" [:div [:p] nil nil [:p/markdown \"best pipeline (found on train data)\"]], \"1792\" [:div [:p] [:div [:p/code {:code \"best-options\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"{:scaling-options {:scale? false},\\n :replace-missing-options\\n {:value\\n  #object[tech.v3.datatype.functional$mean 0x2a05f02a \\\"tech.v3.datatype.functional$mean@2a05f02a\\\"]},\\n :model-options {:trees 50, :max-depth 10}}\\n\"}]], \"1830\" [:div [:p] [:div [:p/code {:code \"(def final-model-by-cv\\n (let [inner-k-fold (ds/split->seq data :kfold {:k 5})\\n       evaluation (ml/evaluate-pipelines\\n                   all-pipelines\\n                   inner-k-fold\\n                   ml/classification-accuracy\\n                   :accuracy)\\n       fit-ctx (-> evaluation first first :fit-ctx)\\n       best-pipefn (-> evaluation first first :pipe-fn)]\\n   {:best-pipe-fn best-pipefn\\n    :fit-ctx fit-ctx}))\", :bg-class \"bg-light\"}]] nil nil], \"1760\" [:div [:p] nil nil [:p/markdown \"Simple split\"]], \"1790\" [:div [:p] nil nil [:p/markdown \"best options (found on train data): \"]], \"1840\" [:div [:p] [:div [:p/code {:code \"(-> final-model :pipe-options)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"{:scaling-options {:scale? false},\\n :replace-missing-options\\n {:value\\n  #object[tech.v3.datatype.functional$mean 0x2a05f02a \\\"tech.v3.datatype.functional$mean@2a05f02a\\\"]},\\n :model-options {:trees 50, :max-depth 10}}\\n\"}]], \"1764\" [:div [:p] [:div [:p/code {:code \"(def train-ds ((first splits) :train))\", :bg-class \"bg-light\"}]] nil nil], \"1750\" [:div [:p] [:div [:p/code {:code \"(defn make-decl-pipeline[model-type options]\\n  [[::assoc-pipe-opts options]\\n   [::replace-missing options]\\n   [:mm/categorical->number [:survived ] {} :int64]\\n   [::maybe-std-scale options]\\n   [:mm/set-inference-target :survived]\\n   {:metamorph/id :model} [:mm/model (merge (:model-options options) {:model-type model-type})]])\", :bg-class \"bg-light\"}]] nil nil], \"1770\" [:div [:p] [:div [:p/code {:code \"(def files [atom []])\", :bg-class \"bg-light\"}]] nil nil], \"1806\" [:div [:p] [:div [:p/code {:code \"(ml/classification-accuracy predicted-survival-hold-out\\n                           (holdout-ds :survived))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.8212290502793296\\n\"}]], \"1812\" [:div [:p] nil nil [:p/markdown \"Smile model object:\"]], \"1786\" [:div [:p] nil nil [:p/markdown \"best accuracy found on train data: \\n0.8576449912126538\"]], \"1754\" [:div [:p] [:div [:p/code {:code \"(def random-forrest-pipelines\\n  (map\\n   #(make-decl-pipeline :smile.classification/random-forest %)\\n   (ml/sobol-gridsearch {:scaling-options {:scale? (ml/categorical [true false])}\\n                         :replace-missing-options {:value (ml/categorical [dtfunc/mean dtfunc/median])}\\n                         :model-options {:trees (ml/categorical [5 50 100 250])\\n                                         :max-depth (ml/categorical [5 8 10])}})))\", :bg-class \"bg-light\"}]] nil nil], \"1768\" [:div [:p] nil nil [:p/markdown \"Tune hyperparameter by evaluating all pipelines/models \"]], \"1762\" [:div [:p] [:div [:p/code {:code \"(def splits (ds/split->seq data :holdout {:ratio 0.8}))\", :bg-class \"bg-light\"}]] nil nil], \"1746\" [:div [:p] [:div [:p/code {:code \"(defn maybe-std-scale [options]\\n  (fn [ctx]\\n    (if (-> options :scaling-options :scale?)\\n      ((mm/std-scale numeric-features {})\\n       ctx)\\n      ctx)))\", :bg-class \"bg-light\"}]] nil nil], \"1788\" [:div [:p] nil nil [:p/markdown \"best accuracy found on test data: \\n0.8461538461538461\"]], \"1834\" [:div [:p] nil nil [:p/markdown \"Final best model\"]], \"1734\" [:div [:p] [:div [:p/code {:code \"(def  categorical-features  [:pclass :sex :embarked])\", :bg-class \"bg-light\"}]] nil nil], \"1742\" [:div [:p] [:div [:p/code {:code \"(def data\\n  (-> (ds/dataset \\\"data/titanic/train.csv\\\"\\n                  {:key-fn csk/->kebab-case-keyword})\\n      (ds/select-columns (concat categorical-features numeric-features [:survived]))\\n      (ds/replace-missing categorical-features :value \\\"missing\\\")\\n      (ds/categorical->one-hot categorical-features)))\", :bg-class \"bg-light\"}]] nil nil], \"1780\" [:div [:p] [:div [:p/code {:code \"best-pipe-fn\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"#object[scicloj.metamorph.core$pipeline$local_pipeline__37517 0x204b49b7 \\\"scicloj.metamorph.core$pipeline$local_pipeline__37517@204b49b7\\\"]\\n\"}]], \"1828\" [:div [:p] [:div [:p/code {:code \"(map :metric nested-cv-result)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"(0.8444444444444444\\n 0.8777777777777778\\n 0.8666666666666667\\n 0.8555555555555556\\n 0.8666666666666667\\n 0.8777777777777778\\n 0.8444444444444444\\n 0.888888888888889\\n 0.8333333333333333\\n 0.8395061728395062)\\n\"}]], \"1738\" [:div [:p] [:div [:p/code {:code \"(defn map->vec [m] (flatten (into [] m)))\", :bg-class \"bg-light\"}]] nil nil], \"1824\" [:div [:p] [:div [:p/code {:code \"(def nested-cv-result\\n (doall\\n  (nested-cv/nested-cv data all-pipelines\\n                       ml/classification-accuracy\\n                       :accuracy 10 5)))\", :bg-class \"bg-light\"}]] nil nil], \"1748\" [:div [:p] [:div [:p/code {:code \"(defn assoc-pipe-opts [options]\\n  (fn [ctx]\\n    (assoc ctx :pipe-options options)))\", :bg-class \"bg-light\"}]] nil nil]}}"</script>
    <script src="gorilla-notes/js/compiled/main.js"></script>
</html>
